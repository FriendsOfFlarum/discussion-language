/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24:(t,e,n)=>{var o=n(163),r=n(110),a=n(996),s=n(312),i=n(166),u=n(766),l=n(760);function c(){"use strict";var e=r(),n=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(n):n.__proto__).constructor;function p(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var d={throw:1,return:2,break:3,continue:3};function m(t){var e,n;return function(o){e||(e={stop:function(){return n(o.a,2)},catch:function(){return o.v},abrupt:function(t,e){return n(o.a,d[t],e)},delegateYield:function(t,r,a){return e.resultName=r,n(o.d,l(t),a)},finish:function(t){return n(o.f,t)}},n=function(t,n,r){o.p=e.prev,o.n=e.next;try{return t(n,r)}finally{e.next=o.n}}),e.resultName&&(e[e.resultName]=o.v,e.resultName=void 0),e.sent=o.v,e.next=o.n;try{return t.call(this,e)}finally{o.p=e.prev,o.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,n,o,r){return e.w(m(t),n,o,r&&r.reverse())},isGeneratorFunction:p,mark:e.m,awrap:function(t,e){return new o(t,e)},AsyncIterator:i,async:function(t,e,n,o,r){return(p(e)?s:a)(m(t),e,n,o,r)},keys:u,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,n)=>{var o=n(397);function r(){var e,n,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function u(t,r,a,s){var i=r&&r.prototype instanceof c?r:c,u=Object.create(i.prototype);return o(u,"_invoke",function(t,o,r){var a,s,i,u=0,c=r||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return a=t,s=0,i=e,p.n=n,l}};function d(t,o){for(s=t,i=o,n=0;!f&&u&&!r&&n<c.length;n++){var r,a=c[n],d=p.p,m=a[2];t>3?(r=m===o)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=d&&((r=t<2&&d<a[1])?(s=0,p.v=o,p.n=a[1]):d<m&&(r=t<3||a[0]>o||o>m)&&(a[4]=t,a[5]=o,p.n=m,s=0))}if(r||t>1)return l;throw f=!0,o}return function(r,c,m){if(u>1)throw TypeError("Generator is already running");for(f&&1===c&&d(c,m),s=c,i=m;(n=s<2?e:i)||!f;){a||(s?s<3?(s>1&&(p.n=-1),d(s,i)):p.n=i:p.v=i);try{if(u=2,a){if(s||(r="next"),n=a[r]){if(!(n=n.call(a,i)))throw TypeError("iterator result is not an object");if(!n.done)return n;i=n.value,s<2&&(s=0)}else 1===s&&(n=a.return)&&n.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+r+"' method"),s=1);a=e}else if((n=(f=p.n<0)?i:t.call(o,p))!==l)break}catch(t){a=e,s=1,i=t}finally{u=1}}return{value:n,done:f}}}(t,a,s),!0),u}var l={};function c(){}function f(){}function p(){}n=Object.getPrototypeOf;var d=[][s]?n(n([][s]())):(o(n={},s,function(){return this}),n),m=p.prototype=c.prototype=Object.create(d);function g(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,o(t,i,"GeneratorFunction")),t.prototype=Object.create(m),t}return f.prototype=p,o(m,"constructor",p),o(p,"constructor",f),f.displayName="GeneratorFunction",o(p,i,"GeneratorFunction"),o(m),o(m,i,"Generator"),o(m,s,function(){return this}),o(m,"toString",function(){return"[object Generator]"}),(t.exports=r=function(){return{w:u,m:g}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,n)=>{var o=n(163),r=n(397);t.exports=function t(e,n){function a(t,r,s,i){try{var u=e[t](r),l=u.value;return l instanceof o?n.resolve(l.v).then(function(t){a("next",t,s,i)},function(t){a("throw",t,s,i)}):n.resolve(l).then(function(t){u.value=t,s(u)},function(t){return a("throw",t,s,i)})}catch(t){i(t)}}var s;this.next||(r(t.prototype),r(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(t,e,o){function r(){return new n(function(e,n){a(t,o,e,n)})}return s=s?s.then(r,r):r()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,n)=>{var o=n(24)();t.exports=o;try{regeneratorRuntime=o}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=o:Function("r","regeneratorRuntime = r")(o)}},312:(t,e,n)=>{var o=n(110),r=n(166);t.exports=function(t,e,n,a,s){return new r(o().w(t,e,n,a),s||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(n,o,r,a){var s=Object.defineProperty;try{s({},"",{})}catch(n){s=0}t.exports=e=function(t,n,o,r){function a(n,o){e(t,n,function(t){return this._invoke(n,o,t)})}n?s?s(t,n,{value:o,enumerable:!r,configurable:!r,writable:!r}):t[n]=o:(a("next",0),a("throw",1),a("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,o,r,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,n)=>{var o=n(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(o(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),n=[];for(var o in e)n.unshift(o);return function t(){for(;n.length;)if((o=n.pop())in e)return t.value=o,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},880:t=>{t.exports=function(t){for(var e=[],n=0,o=0,r=0,a=t.length;r<a;)n=t.charCodeAt(r++),o?(e.push((65536+(o-55296<<10)+(n-56320)).toString(16)),o=0):55296<=n&&n<=56319?o=n:e.push(n.toString(16));return e.join("-")}},996:(t,e,n)=>{var o=n(312);t.exports=function(t,e,n,r,a){var s=o(t,e,n,r,a);return s.next().then(function(t){return t.done?t.value:s.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o](a,a.exports,n),a.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};(()=>{"use strict";n.r(o),n.d(o,{components:()=>G,extend:()=>ot,models:()=>H,utils:()=>z});var t={};n.r(t),n.d(t,{default:()=>A,getEmoji:()=>V,load:()=>T});const e=flarum.core.compat["admin/app"];var r=n.n(e);const a=flarum.core.compat["admin/components/SettingDropdown"];var s=n.n(a);function i(t,e,n,o,r,a,s){try{var i=t[a](s),u=i.value}catch(t){return void n(t)}i.done?e(u):Promise.resolve(u).then(o,r)}function u(t){return function(){var e=this,n=arguments;return new Promise(function(o,r){var a=t.apply(e,n);function s(t){i(a,o,r,s,u,"next",t)}function u(t){i(a,o,r,s,u,"throw",t)}s(void 0)})}}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function c(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}var f=n(183),p=n.n(f);const d=flarum.core.compat["admin/components/ExtensionPage"];var g=n.n(d);const v=flarum.core.compat["common/components/Button"];var h=n.n(v);const b=flarum.core.compat["common/components/Select"];var y=n.n(b);const _=flarum.core.compat["common/components/LoadingIndicator"];var x=n.n(_);const w=flarum.core.compat["common/helpers/icon"];var S=n.n(w);const j=flarum.core.compat["common/utils/Stream"];var O=n.n(j);const N=flarum.core.compat["common/components/Alert"];var D,L=n.n(N);function k(t){return M.apply(this,arguments)}function M(){return(M=u(p().mark(function t(e){var n,o;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=r().forum.attribute("assetsBaseUrl")+"/extensions/fof-discussion-language/"+e,t.next=1,fetch(n);case 1:if((o=t.sent).ok){t.next=2;break}if(404!==o.status){t.next=2;break}throw new Error("Missing asset (`"+e+"`): "+n);case 2:return t.next=3,o.json();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}var P=function(){var t=u(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,k("iso-639-2.json");case 1:return D=t.sent,t.abrupt("return",D);case 2:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}(),C=function(t,e){return e&&(null==t?void 0:t["Native name(s)"])||(null==t?void 0:t["Language name(s)"])};const F=function(t){var e;return null==(e=Array.from(Object.values(D||{})))?void 0:e.sort(function(e,n){var o,r;return(null==(o=C(e,t))?void 0:o.toLowerCase())>(null==(r=C(n,t))?void 0:r.toLowerCase())}).reduce(function(e,n){return e[n["639-1"]||n["639-2"]]=C(n,t),e},{})};var E,T=function(){var t=u(p().mark(function t(){return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,k("countries.json");case 1:return E=t.sent,t.abrupt("return",E);case 2:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}();function A(t){if(!E)return{};var e=t?"native":"name";return Object.entries(E).reduce(function(t,n){var o=n[0],r=n[1];return t[o]=r[e],t},{})}var V=function(t){var e;return null==(e=E)||null==(e=e[t])?void 0:e.emoji},R=function(t){function e(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).recordsUpdating={},e.recordsDeleting={},e.newLocaleValue=O()(""),e.newCountryValue=O()(""),e.loadingData=!0,e.loadingDataError=!1,e.errorDetails=null,e.isAddingNewRecord=!1,e}c(e,t);var n=e.prototype;return n.oncreate=function(e){t.prototype.oncreate.call(this,e),this.loadData()},n.loadData=function(){var t=u(p().mark(function t(){var e;return p().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingData=!0,this.loadingDataError=!1,m.redraw(),t.prev=1,t.next=2,Promise.all([P(),T()]);case 2:this.loadingData=!1,this.loadingDataError=!1,m.redraw(),t.next=4;break;case 3:t.prev=3,e=t.catch(1),console.error(e),this.loadingData=!1,this.loadingDataError=!0,this.errorDetails=e,m.redraw();case 4:case"end":return t.stop()}},t,this,[[1,3]])}));return function(){return t.apply(this,arguments)}}(),n.content=function(t){return m("div",{className:"container"},m("div",{className:"FofDiscussionLanguagesSettingsPage"},m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.native_label"),setting:"fof-discussion-language.native"})),m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.show_flag_label"),setting:"fof-discussion-language.showFlags"})),m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.composer_default_label"),setting:"fof-discussion-language.composerLocaleDefault"})),m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.locale_sort_label"),setting:"fof-discussion-language.filter_language_on_http_request"})),m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.show_any_lang_opt_label"),setting:"fof-discussion-language.showAnyLangOpt"})),m("div",{className:"Form-group"},this.buildSettingComponent({type:"bool",label:r().translator.trans("fof-discussion-language.admin.settings.tags_page_discussion_locale_label"),setting:"fof-discussion-language.useLocaleForTagsPageLastDiscussion"})),this.submitButton(t),m("hr",null),this.localeSettings(),m("p",{className:"helpText"},"This extension uses material from the Wikipedia article"," ",m("a",{href:"https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes",target:"_blank",rel:"noreferrer nofollow noopener"},"List of ISO 639-2 Codes"),", which is released under the"," ",m("a",{href:"https://creativecommons.org/licenses/by-sa/3.0/"},"Creative Commons Attribution-Share-Alike License 3.0"),".")))},n.localeSettings=function(){var t,e=this;if(this.loadingData)return m(x(),null);if(this.loadingDataError)return m(L(),{dismissible:!1,type:"error"},r().translator.trans("fof-discussion-language.admin.settings.errors.missing_assets"),m("br",null),m("b",null,"Error:")," ",m("code",null,null==(t=this.errorDetails)?void 0:t.message));var n=!!Number(this.setting("fof-discussion-language.native")()),o=F(n),a=A(n);return m("[",null,m("div",{className:"Form-group flex",style:{"margin-bottom":0,"font-weight":"bold"}},m("span",null,r().translator.trans("fof-discussion-language.admin.settings.config.language_label")),m("span",null,r().translator.trans("fof-discussion-language.admin.settings.config.country_label")),m("span",null),m("span",null)),m("div",{className:"Form-group flex"},y().component({onchange:this.newLocaleValue,value:this.newLocaleValue(),options:o}),y().component({onchange:this.newCountryValue,value:this.newCountryValue(),options:a}),h().component({className:"Button Button--primary",onclick:this.add.bind(this),disabled:!this.newLocaleValue()||!this.newCountryValue()||this.isAddingNewRecord},S()(this.isAddingNewRecord?"fas fa-spinner fa-spin":"fas fa-plus"))),m("div",{className:"Form-group"},r().store.all("discussion-languages").map(function(t){var n=t.id(),r=e.recordsUpdating[n],s=e.recordsDeleting[n],i=t.country();return m("div",{className:"flex"},y().component({onchange:function(o){e.recordsUpdating[n]=!0,t.save({code:o}).then(function(){e.recordsUpdating[n]=!1,m.redraw()})},value:t.code(),options:o,disabled:r||s}),y().component({onchange:function(o){e.recordsUpdating[n]=!0,t.save({country:o}).then(function(){e.recordsUpdating[n]=!1,m.redraw()})},value:i,options:a,disabled:r||s}),h().component({className:"Button Button--danger",disabled:s,onclick:e.remove.bind(e,t)},S()(s?"fas fa-spinner fa-spin":"fas fa-times")))})))},n.onkeydown=function(t){"Enter"===t.key&&(this.add(),t.preventDefault())},n.add=function(){var t=this;if(!this.isAddingNewRecord&&this.newLocaleValue()){this.isAddingNewRecord=!0;var e=this.newLocaleValue(),n=this.newCountryValue();r().store.createRecord("discussion-languages").save({code:e,country:n}).then(function(){t.newLocaleValue(""),t.newCountryValue("")}).catch(function(){}).finally(function(){t.isAddingNewRecord=!1,m.redraw()})}},n.remove=function(t){var e=this;this.recordsDeleting[t.id()]=!0,t.delete().then(function(){},function(){}).then(function(){delete e.recordsDeleting[t.id()],m.redraw()})},e}(g()),G={LanguagesSettingsPage:R};function B(){return B=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},B.apply(null,arguments)}var I=n(880),U=n.n(I),z=B({getCountry:A,countries:t,locales:F,getName:function(t,e){var n;return C(null==(n=D)?void 0:n.find(function(e){return[e["639-1"]||e["639-2"]].includes(t)}),e)}},{flag:function(t){if(t){var e=t.emoji?t.emoji():t;return e?m("img",{alt:t.country&&t.country()||"",className:"emoji",draggable:"false",loading:"lazy",src:"//cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/72x72/"+U()(e)+".png"}):S()("fas fa-globe")}}});const q=flarum.core.compat["common/Model"];var W=n.n(q),Y=function(t){function e(){return t.apply(this,arguments)||this}c(e,t);var n=e.prototype;return n.id=function(){return W().attribute("id").call(this)},n.code=function(){return W().attribute("code").call(this)},n.country=function(){return W().attribute("country").call(this)},n.name=function(){return W().attribute("name").call(this)},n.emoji=function(){return W().attribute("emoji").call(this)},n.apiEndpoint=function(){return"/fof/discussion-language"+(this.exists?"/"+this.data.id:"")},e}(W()),H={Language:Y};const J=flarum.core.compat["common/extenders"];var K=n.n(J);const Q=flarum.core.compat["common/models/Discussion"];var X=n.n(Q);const Z=flarum.core.compat["common/models/Forum"];var $=n.n(Z);const tt=flarum.core.compat["tags/common/models/Tag"];var et=n.n(tt);const nt=[(new(K().Store)).add("discussion-languages",Y),new(K().Model)(X()).hasOne("language").attribute("canChangeLanguage"),new(K().Model)($()).hasMany("discussionLanguages"),new(K().Model)(et()).attribute("subscriptionLanguage").attribute("localisedLastDiscussion")],ot=[].concat(nt);r().initializers.add("fof/discussion-language",function(){r().extensionData.for("fof-discussion-language").registerPage(R).registerPermission({permission:"discussion.changeLanguageModerate",icon:"fas fa-globe",label:r().translator.trans("fof-discussion-language.admin.permissions.allow_change_language_label")},"moderate",65).registerPermission({icon:"fas fa-globe",label:r().translator.trans("fof-discussion-language.admin.permissions.allow_change_language_label"),setting:function(){var t=parseInt(r().data.settings["fof-discussion-language.allow_language_change"]);return s().component({defaultLabel:t?r().translator.trans("core.admin.permissions_controls.allow_some_minutes_button",{count:t}):r().translator.trans("core.admin.permissions_controls.allow_indefinitely_button"),key:"fof-discussion-language.allow_language_change",options:[{value:"-1",label:r().translator.trans("core.admin.permissions_controls.allow_indefinitely_button")},{value:"10",label:r().translator.trans("core.admin.permissions_controls.allow_ten_minutes_button")},{value:"reply",label:r().translator.trans("core.admin.permissions_controls.allow_until_reply_button")}]})}},"start",65)})})(),module.exports=o})();
//# sourceMappingURL=admin.js.map