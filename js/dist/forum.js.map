{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@fof/discussion-language/./node_modules/twemoji-basename/index.js","webpack://@fof/discussion-language/webpack/bootstrap","webpack://@fof/discussion-language/webpack/runtime/compat get default export","webpack://@fof/discussion-language/webpack/runtime/define property getters","webpack://@fof/discussion-language/webpack/runtime/hasOwnProperty shorthand","webpack://@fof/discussion-language/webpack/runtime/make namespace object","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/app']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/extend']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/components/Button']\"","webpack://@fof/discussion-language/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@fof/discussion-language/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/Component']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@fof/discussion-language/./src/common/utils/flag.js","webpack://@fof/discussion-language/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@fof/discussion-language/./src/forum/utils/generateLanguageOptions.tsx","webpack://@fof/discussion-language/./src/forum/components/LanguageDisplay.tsx","webpack://@fof/discussion-language/./src/forum/components/LanguageDiscussionModal.js","webpack://@fof/discussion-language/./src/forum/addEditLanguageModal.js","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@fof/discussion-language/./src/forum/addLanguageComposer.js","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/components/DiscussionHero']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['forum/states/GlobalSearchState']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/utils/setRouteWithForcedRefresh']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@fof/discussion-language/./src/forum/components/LanguageDropdown.tsx","webpack://@fof/discussion-language/./src/forum/addLanguageToDiscussionList.js","webpack://@fof/discussion-language/external root \"flarum.core.compat['tags/common/models/Tag']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/Model']\"","webpack://@fof/discussion-language/external assign \"flarum.extensions['fof-follow-tags']\"","webpack://@fof/discussion-language/./src/forum/components/index.js","webpack://@fof/discussion-language/./src/common/utils/index.js","webpack://@fof/discussion-language/./src/common/models/Language.ts","webpack://@fof/discussion-language/./src/common/models/index.ts","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/extenders']\"","webpack://@fof/discussion-language/external root \"flarum.core.compat['common/models/Forum']\"","webpack://@fof/discussion-language/./src/common/extend.ts","webpack://@fof/discussion-language/./src/forum/extend.ts","webpack://@fof/discussion-language/./src/forum/index.ts","webpack://@fof/discussion-language/./src/forum/useLocalisedLastDiscussionOnTagsPage.ts","webpack://@fof/discussion-language/./src/forum/extendSubscriptionModal.js"],"sourcesContent":["/*! Copyright Twitter Inc. and other contributors. Licensed under MIT */\n/* https://github.com/twitter/twemoji/blob/gh-pages/LICENSE */\n\nmodule.exports = function (str) {\n  var r = []\n  var c = 0\n  var p = 0\n  var i = 0\n  var l = str.length\n\n  while (i < l) {\n    c = str.charCodeAt(i++)\n    if (p) {\n      r.push((0x10000 + ((p - 0xD800) << 10) + (c - 0xDC00)).toString(16))\n      p = 0\n    } else if (0xD800 <= c && c <= 0xDBFF) {\n      p = c\n    } else {\n      r.push(c.toString(16))\n    }\n  }\n\n  return r.join('-')\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","import basename from 'twemoji-basename';\nimport icon from 'flarum/common/helpers/icon';\n\nexport default (language) => {\n  if (!language) return;\n\n  const emoji = language.emoji ? language.emoji() : language;\n\n  return emoji ? (\n    <img\n      alt={(language.country && language.country()) || ''}\n      className=\"emoji\"\n      draggable=\"false\"\n      loading=\"lazy\"\n      src={`//cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/72x72/${basename(emoji)}.png`}\n    />\n  ) : (\n    icon('fas fa-globe')\n  );\n};\n","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","import Language from '../../common/models/Language';\nimport LanguageDisplay from '../components/LanguageDisplay';\nimport app from 'flarum/forum/app';\nimport type Mithril from 'mithril';\n\nexport default function generateLanguageOptions(extraOptions?: Record<string, Mithril.Children>): Record<string, Mithril.Children> {\n  const options: Record<string, Mithril.Children> = {};\n  const languages = app.store.all<Language>('discussion-languages');\n\n  // Populate the options with the languages\n  languages.forEach((lang) => {\n    options[lang.code()] = <LanguageDisplay language={lang} />;\n  });\n\n  // Merge extra options, if provided\n  return { ...options, ...extraOptions };\n}\n","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport flag from '../../common/utils/flag';\nimport Language from '../../common/models/Language';\nimport type Mithril from 'mithril';\nimport generateLanguageOptions from '../utils/generateLanguageOptions';\n\ninterface LanguageDisplayAttrs {\n  language: Language;\n  uppercase?: boolean;\n  extra?: Record<string, Mithril.Children>;\n}\n\nexport default class LanguageDisplay extends Component<LanguageDisplayAttrs> {\n  options!: Record<string, Mithril.Children>;\n\n  oninit(vnode: Mithril.Vnode<LanguageDisplayAttrs, this>): void {\n    super.oninit(vnode);\n\n    this.options = generateLanguageOptions(this.attrs.extra);\n  }\n\n  view(): Mithril.Child {\n    const { language, uppercase } = this.attrs;\n    const name = language.name() || '';\n\n    return (\n      <span>\n        {flag(language)} {uppercase ? name.toUpperCase() : name}\n      </span>\n    );\n  }\n}\n","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\n\nimport LanguageDisplay from './LanguageDisplay';\n\nexport default class LanguageDiscussionModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    this.languages = app.store.all('discussion-languages').filter((language) => language.code() !== 'any');\n\n    this.current = this.attrs.selected || (this.attrs.discussion && this.attrs.discussion.language());\n    this.selected = this.current;\n  }\n\n  className() {\n    return 'FoFLanguageDiscussionModal';\n  }\n\n  title() {\n    return this.attrs.discussion\n      ? app.translator.trans('fof-discussion-language.forum.change_language.edit_title', { title: <em>{this.attrs.discussion.title()}</em> })\n      : app.translator.trans('fof-discussion-language.forum.change_language.title');\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"Form-group\">\n          {this.languages.map((language) => (\n            <Button onclick={this.select.bind(this, language)} className={`Button Button--block ${this.selected === language ? 'active' : ''}`}>\n              <LanguageDisplay language={language} uppercase={true} />\n            </Button>\n          ))}\n        </div>\n\n        {!this.attrs.hideSubmitButton && (\n          <div className=\"App-primaryControl\">\n            {Button.component(\n              {\n                type: 'submit',\n                className: 'Button Button--primary',\n                disabled: !this.selected || this.selected === this.current,\n                loading: this.loading,\n                icon: 'fas fa-check',\n              },\n              app.translator.trans('fof-discussion-language.forum.change_language.submit_button')\n            )}\n          </div>\n        )}\n      </div>,\n    ];\n  }\n\n  select(language) {\n    this.selected = language;\n\n    if (this.attrs.hideSubmitButton) return this.onsubmit();\n\n    m.redraw();\n  }\n\n  onsubmit(e) {\n    if (e) e.preventDefault();\n\n    const { discussion, onsubmit } = this.attrs;\n\n    this.loading = true;\n\n    if (!discussion) {\n      this.hide();\n\n      if (onsubmit) onsubmit(this.selected);\n\n      return;\n    }\n\n    const language = this.selected;\n\n    discussion\n      .save({ relationships: { language } })\n      .then(() => {\n        if (app.current instanceof DiscussionPage) {\n          app.current.stream.update();\n        }\n\n        return this.hide();\n      })\n      .catch(this.loaded.bind(this));\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport Button from 'flarum/common/components/Button';\n\nimport LanguageDiscussionModal from './components/LanguageDiscussionModal';\n\nexport default () => {\n  extend(DiscussionControls, 'moderationControls', function (items, discussion) {\n    if (discussion.canChangeLanguage()) {\n      items.add(\n        'language',\n        Button.component(\n          {\n            icon: 'fas fa-globe',\n            onclick: () => app.modal.show(LanguageDiscussionModal, { discussion }),\n          },\n          app.translator.trans('fof-discussion-language.forum.discussion_controls.change_language_button')\n        )\n      );\n    }\n  });\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","import { extend, override } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\n\nimport LanguageDiscussionModal from './components/LanguageDiscussionModal';\nimport LanguageDisplay from './components/LanguageDisplay';\n\nconst sort = (a, b) => a.code().toLowerCase() > b.code().toLowerCase();\n\nexport default () => {\n  extend(IndexPage.prototype, 'newDiscussionAction', function (promise) {\n    const dislang = app.search.params().language;\n\n    if (dislang) {\n      promise.then((composer) => (composer.fields.language = app.store.getBy('discussion-languages', 'code', dislang)));\n    } else {\n      const localeComposer = app.forum.attribute('fof-discussion-language.composerLocaleDefault');\n      app.composer.fields.language = localeComposer ? app.store.getBy('discussion-languages', 'code', app.translator.getLocale()) : '';\n    }\n  });\n\n  DiscussionComposer.prototype.chooseLanguage = function (hide, callback) {\n    app.modal.show(LanguageDiscussionModal, {\n      selected: this.composer.fields.language,\n      hideSubmitButton: hide,\n      onsubmit: (language) => {\n        this.composer.fields.language = language;\n        this.$('textarea').focus();\n\n        if (callback) callback();\n      },\n    });\n  };\n\n  extend(DiscussionComposer.prototype, 'headerItems', function (items) {\n    // Don't add lang item to byobu composers\n    if (this._isByobuComposer) return;\n\n    items.add(\n      'language',\n      <a className=\"DiscussionComposer-changeTags\" onclick={this.chooseLanguage.bind(this, true, null)}>\n        <span className={`LanguageLabel ${this.composer.fields.language ? '' : 'none'}`}>\n          {this.composer.fields.language\n            ? LanguageDisplay.component({ language: this.composer.fields.language, uppercase: true })\n            : app.translator.trans('fof-discussion-language.forum.composer_discussion.choose_language_link')}\n        </span>\n      </a>,\n      20\n    );\n  });\n\n  override(DiscussionComposer.prototype, 'onsubmit', function (original) {\n    // Don't add lang stuff to byobu composers\n    if (this._isByobuComposer) return original();\n\n    if (!this.composer.fields.language) return this.chooseLanguage(true, original);\n\n    original();\n  });\n\n  extend(DiscussionComposer.prototype, 'data', function (data) {\n    // Don't add lang stuff to byobu composers\n    if (this._isByobuComposer) return;\n\n    data.relationships = data.relationships || {};\n\n    data.relationships.language = this.composer.fields.language || app.store.all('discussion-languages').sort(sort)[0];\n  });\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionHero'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/GlobalSearchState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/setRouteWithForcedRefresh'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","import app from 'flarum/forum/app';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown, { IDropdownAttrs } from 'flarum/common/components/Dropdown';\nimport type Mithril from 'mithril';\nimport icon from 'flarum/common/helpers/icon';\nimport classList from 'flarum/common/utils/classList';\nimport generateLanguageOptions from '../utils/generateLanguageOptions';\nimport Stream from 'flarum/common/utils/Stream';\n\nexport interface LanguageDropdownAttrs extends IDropdownAttrs {\n  className?: string;\n  selected?: string;\n  onclick?: (langId: string) => void;\n  extra?: Record<string, Mithril.Children>;\n}\n\nexport default class LanguageDropdown extends Dropdown<LanguageDropdownAttrs> {\n  selected!: Stream<string>;\n  options!: Record<string, Mithril.Children>;\n  loaded: boolean = false;\n\n  static initAttrs(attrs: LanguageDropdownAttrs): void {\n    attrs.buttonClassName = 'Button';\n    attrs.className = classList(attrs.className, 'Dropdown--select', 'Dropdown--language');\n    super.initAttrs(attrs);\n  }\n\n  oninit(vnode: Mithril.Vnode<LanguageDropdownAttrs, this>): void {\n    super.oninit(vnode);\n\n    this.loadLanguages();\n    this.selected = Stream(this.initSelectedLanguage());\n  }\n\n  getDefaultLanguage(): string {\n    return (app.forum.attribute('fof-discussion-language.showAnyLangOpt') ? 'any' : app.translator.getLocale()) || '';\n  }\n\n  initSelectedLanguage(): string {\n    return this.attrs.selected || this.getDefaultLanguage();\n  }\n\n  loadLanguages(): void {\n    if (this.loaded === false) {\n      this.options = generateLanguageOptions(this.attrs.extra);\n      this.loaded = true;\n    }\n  }\n\n  buildDropdownContent(): Mithril.ChildArray {\n    return Object.keys(this.options).map((langId) => {\n      const isItemSelected = this.selected() === langId;\n\n      return (\n        <Button\n          key={langId + isItemSelected}\n          active={isItemSelected}\n          icon={isItemSelected ? 'fas fa-check' : true}\n          onclick={() => {\n            this.selected(langId);\n\n            if (this.attrs.onclick) {\n              this.attrs.onclick.call(this, langId);\n            }\n          }}\n          aria-label={langId}\n        >\n          {this.options[langId]}\n        </Button>\n      );\n    });\n  }\n\n  view(vnode: Mithril.Vnode<LanguageDropdownAttrs, this>) {\n    const children = this.buildDropdownContent();\n\n    return super.view({ ...vnode.attrs, children });\n  }\n\n  getButton(children: Mithril.ChildArray): Mithril.Vnode<any, any> {\n    return (\n      <button\n        key={this.selected() + 'Button'}\n        className={'Dropdown-toggle ' + this.attrs.buttonClassName}\n        aria-haspopup=\"menu\"\n        aria-label={this.attrs.accessibleToggleLabel}\n        data-toggle=\"dropdown\"\n        onclick={this.attrs.onclick}\n      >\n        {this.getButtonContent(children)}\n      </button>\n    );\n  }\n\n  getButtonContent(children: Mithril.ChildArray): Mithril.ChildArray {\n    return [\n      <span className=\"Button-label\">{this.options[this.selected()]}</span>,\n      this.attrs.caretIcon ? icon(this.attrs.caretIcon, { className: 'Button-caret' }) : null,\n    ];\n  }\n\n  getMenu(items: Mithril.Vnode<any, any>[]): Mithril.Vnode<any, any> {\n    return (\n      <ul key={this.selected() + 'Menu'} className={'Dropdown-menu dropdown-menu ' + this.attrs.menuClassName}>\n        {items}\n      </ul>\n    );\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport DiscussionHero from 'flarum/forum/components/DiscussionHero';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport GlobalSearchState from 'flarum/forum/states/GlobalSearchState';\nimport setRouteWithForcedRefresh from 'flarum/common/utils/setRouteWithForcedRefresh';\n\nimport flag from '../common/utils/flag';\nimport LanguageDropdown from './components/LanguageDropdown';\n\nconst addLanguage = function (items) {\n  // Ignore PDs from Byobu\n  // Must be conditional call in case byobu not installed\n  if (this.attrs.discussion.isPrivateDiscussion?.()) return;\n\n  const language = this.attrs.discussion.language();\n\n  if (!language) return;\n\n  items.add(\n    'discussion-language',\n    <span>\n      {flag(language) || <i className=\"fas fa-globe\" />}\n      <code>{language.name()}</code>\n    </span>,\n    5\n  );\n};\n\nexport default () => {\n  extend(DiscussionListItem.prototype, 'infoItems', addLanguage);\n  extend(DiscussionHero.prototype, 'items', addLanguage);\n\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\n    const routeName = app.current.data.routeName;\n\n    if (routeName === 'byobuPrivate') return;\n    if (routeName === 'byobuUserPrivate') return;\n\n    params.include.push('language');\n\n    // Do not filter user discussions page as there is no dropdown\n    if (routeName === 'user.discussions') return;\n\n    // Required until https://github.com/flarum/framework/pull/3376 is released.\n    if (routeName === 'following' && params.filter.q) {\n      params.filter.q += ` is:${params.filter.subscription || 'following'}`;\n      delete params.filter.subscription;\n    }\n\n    const paramLang = app.search.params().language;\n    const locale = app.search.params().language ?? app.translator.getLocale();\n    const showAnyOpt = app.forum.attribute('fof-discussion-language.showAnyLangOpt');\n\n    if (params.filter.q) {\n      if (showAnyOpt) {\n        if (paramLang) {\n          params.filter.q += ' language:' + paramLang;\n        }\n      } else {\n        params.filter.q += ' language:' + locale;\n      }\n    } else {\n      if (!showAnyOpt || paramLang) {\n        params.filter.language = locale;\n      }\n    }\n  });\n\n  extend(GlobalSearchState.prototype, 'stickyParams', (params) => (params.language = m.route.param('language')));\n\n  extend(IndexPage.prototype, 'viewItems', function (items) {\n    // Don't add language controls to /private (fof/byobu)\n    if (app.current.data.routeName === 'byobuPrivate') return;\n\n    const defaultSelected = app.forum.attribute('fof-discussion-language.showAnyLangOpt') ? 'any' : app.translator.getLocale();\n\n    items.add(\n      'language',\n      <LanguageDropdown\n        selected={app.search.params().language}\n        onclick={(key) => {\n          // if `key` is not a string, return early\n          if (typeof key !== 'string') return;\n\n          const params = app.search.params();\n\n          if (key === defaultSelected) delete params.language;\n          else params.language = key;\n\n          setRouteWithForcedRefresh(app.route(app.current.get('routeName'), params));\n        }}\n      />\n    );\n  });\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/common/models/Tag'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Discussion'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.extensions['fof-follow-tags'];","import LanguageDisplay from './LanguageDisplay';\nimport LanguageDiscussionModal from './LanguageDiscussionModal';\nimport LanguageDropdown from './LanguageDropdown';\n\nexport const components = {\n  LanguageDisplay,\n  LanguageDiscussionModal,\n  LanguageDropdown,\n};\n","import flag from './flag';\n\nexport const utils = {\n  flag,\n};\n","import Model from 'flarum/common/Model';\n\nexport default class Language extends Model {\n  id() {\n    return Model.attribute<string>('id').call(this);\n  }\n\n  code() {\n    return Model.attribute<string>('code').call(this);\n  }\n\n  country() {\n    return Model.attribute<string>('country').call(this);\n  }\n\n  name() {\n    return Model.attribute<string>('name').call(this);\n  }\n\n  emoji() {\n    return Model.attribute<string>('emoji').call(this);\n  }\n\n  apiEndpoint() {\n    return `/fof/discussion-language${this.exists ? `/${this.data.id}` : ''}`;\n  }\n}\n","import Language from './Language';\n\nexport const models = {\n  Language,\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Forum'];","import Extend from 'flarum/common/extenders';\nimport Language from '../common/models/Language';\nimport Discussion from 'flarum/common/models/Discussion';\nimport Forum from 'flarum/common/models/Forum';\nimport Tag from 'flarum/tags/common/models/Tag';\n\nexport default [\n  new Extend.Store() //\n    .add('discussion-languages', Language),\n\n  new Extend.Model(Discussion) //\n    .hasOne('language')\n    .attribute<boolean>('canChangeLanguage'),\n\n  new Extend.Model(Forum) //\n    .hasMany<Language>('discussionLanguages'),\n\n  new Extend.Model(Tag) //\n    .attribute<string>('subscriptionLanguage')\n    .attribute<string>('localisedLastDiscussion'),\n];\n","import commonExtend from '../common/extend';\n\nexport default [...commonExtend];\n","import app from 'flarum/forum/app';\nimport addEditLanguageModal from './addEditLanguageModal';\nimport addLanguageComposer from './addLanguageComposer';\nimport addLanguageToDiscussionList from './addLanguageToDiscussionList';\nimport useLocalisedLastDiscussionOnTagsPage from './useLocalisedLastDiscussionOnTagsPage';\nimport extendSubscriptionModal from './extendSubscriptionModal';\n\nexport * from './components';\nexport * from '../common/utils';\nexport * from '../common/models';\nexport { default as extend } from './extend';\n\napp.initializers.add('fof/discussion-language', () => {\n  addEditLanguageModal();\n  addLanguageComposer();\n  addLanguageToDiscussionList();\n  useLocalisedLastDiscussionOnTagsPage();\n  extendSubscriptionModal();\n});\n","import app from 'flarum/forum/app';\n\nimport Tag from 'flarum/tags/common/models/Tag';\n\nimport Discussion from 'flarum/common/models/Discussion';\nimport Model from 'flarum/common/Model';\n\nexport default function useLocalisedLastDiscussionOnTagsPage() {\n  if (!('flarum-tags' in flarum.extensions)) return;\n\n  Tag.prototype.lastPostedDiscussion = function (this: Tag) {\n    const original = Model.hasOne('lastPostedDiscussion').bind(this);\n\n    if (!app.forum.attribute('fof-discussion-language.useLocaleForTagsPageLastDiscussion')) {\n      return original();\n    }\n\n    const data = this.localisedLastDiscussion();\n\n    /**\n     * Priorities:\n     *\n     * 1. User's selected forum locale\n     * 2. Detected locale\n     * 3. First disucssion language available\n     */\n    const desiredLanguageCode =\n      app.session.user?.preferences?.()?.locale || (app.translator as any).formatter.locale || (app.forum as any).discussionLanguages()[0].code();\n\n    const desiredLanguageId = (app.forum as any)\n      .discussionLanguages()\n      .find((lang: any) => lang.code() === desiredLanguageCode)\n      ?.id();\n\n    // If forum locale not available as a discussion lang, default to any language\n    if (!desiredLanguageId) {\n      return original();\n    }\n\n    const discussion = data[desiredLanguageId];\n\n    // fall back to original attribute\n    if (!discussion) return original();\n\n    return new Discussion({\n      attributes: {\n        title: discussion.title,\n        slug: discussion.id, // navigating using only ID works fine\n        lastPostedAt: new Date(discussion.at * 1000).toISOString(),\n      },\n    });\n  };\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport { components } from '@fof-follow-tags';\nimport LanguageDropdown from './components/LanguageDropdown';\nimport Stream from 'flarum/common/utils/Stream';\n\nconst SUBSCRIPTION_LANGUAGE_PRIORITY = 80;\n\nexport default function extendSubscriptionModal() {\n  if (!('fof-follow-tags' in flarum.extensions)) return;\n\n  extend(components.SubscriptionModal.prototype, 'oninit', function () {\n    const tag = this.attrs.model;\n    const subscriptionLanguage = tag.subscriptionLanguage();\n    this.language = Stream(subscriptionLanguage);\n  });\n\n  extend(components.SubscriptionModal.prototype, 'formOptionItems', function (items) {\n    items.add(\n      'subscription_language',\n      <div className=\"Form-group\">\n        <label>{app.translator.trans('fof-discussion-language.forum.sub_controls.subscription_language_label')}</label>\n        <p className=\"helpText\">{app.translator.trans('fof-discussion-language.forum.sub_controls.subscription_language_help')}</p>\n        <LanguageDropdown\n          selected={this.language()}\n          onclick={(key) => {\n            if (typeof key !== 'string') return;\n\n            this.language(key);\n          }}\n        />\n      </div>,\n      SUBSCRIPTION_LANGUAGE_PRIORITY\n    );\n  });\n\n  extend(components.SubscriptionModal.prototype, 'requestData', function (data) {\n    data.language = this.language();\n\n    return data;\n  });\n}\n"],"names":["module","exports","str","r","c","p","i","l","length","charCodeAt","push","toString","join","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","n","getter","__esModule","d","a","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","create","constructor","language","emoji","alt","country","className","draggable","loading","src","basename","icon","_extends","assign","target","arguments","source","apply","this","generateLanguageOptions","extraOptions","options","app","all","forEach","lang","code","LanguageDisplay","oninit","vnode","attrs","extra","view","uppercase","name","flag","toUpperCase","Component","LanguageDiscussionModal","languages","filter","current","selected","discussion","title","trans","content","map","onclick","select","bind","hideSubmitButton","Button","type","disabled","onsubmit","m","redraw","e","preventDefault","hide","save","relationships","then","DiscussionPage","stream","update","loaded","Modal","sort","b","toLowerCase","LanguageDropdown","initAttrs","buttonClassName","classList","loadLanguages","Stream","initSelectedLanguage","getDefaultLanguage","attribute","getLocale","buildDropdownContent","keys","langId","isItemSelected","active","children","getButton","accessibleToggleLabel","getButtonContent","caretIcon","getMenu","items","menuClassName","Dropdown","addLanguage","isPrivateDiscussion","add","extensions","components","utils","Language","id","Model","apiEndpoint","exists","data","models","Extend","Discussion","hasOne","Forum","hasMany","Tag","commonExtend","extend","DiscussionControls","canChangeLanguage","show","IndexPage","promise","dislang","params","composer","fields","getBy","localeComposer","DiscussionComposer","chooseLanguage","callback","$","focus","_isByobuComposer","component","override","original","DiscussionListItem","DiscussionHero","DiscussionListState","routeName","include","q","subscription","paramLang","locale","showAnyOpt","GlobalSearchState","route","param","defaultSelected","setRouteWithForcedRefresh","lastPostedDiscussion","localisedLastDiscussion","desiredLanguageCode","user","preferences","formatter","discussionLanguages","desiredLanguageId","find","attributes","slug","lastPostedAt","Date","at","toISOString","SubscriptionModal","subscriptionLanguage","model"],"sourceRoot":""}