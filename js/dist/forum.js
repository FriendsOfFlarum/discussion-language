/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={879:t=>{t.exports=function(t){for(var e=[],o=0,n=0,a=0,s=t.length;a<s;)o=t.charCodeAt(a++),n?(e.push((65536+(n-55296<<10)+(o-56320)).toString(16)),n=0):55296<=o&&o<=56319?n=o:e.push(o.toString(16));return e.join("-")}}},e={};function o(n){var a=e[n];if(void 0!==a)return a.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,o),s.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";o.r(n),o.d(n,{components:()=>Z,models:()=>et,utils:()=>tt});const t=flarum.core.compat["forum/app"];var e=o.n(t);const a=flarum.core.compat["common/Model"];var s=o.n(a);const r=flarum.core.compat["common/models/Forum"];var i=o.n(r);const u=flarum.core.compat["tags/common/models/Tag"];var c=o.n(u);const l=flarum.core.compat["common/models/Discussion"];var g=o.n(l);function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}function d(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,f(t,e)}var p=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).code=s().attribute("code"),e.country=s().attribute("country"),e.name=s().attribute("name"),e.emoji=s().attribute("emoji"),e}return d(e,t),e.prototype.apiEndpoint=function(){return"/fof/discussion-language"+(this.exists?"/"+this.data.id:"")},e}(s());const h=flarum.core.compat["common/extend"],v=flarum.core.compat["forum/utils/DiscussionControls"];var y=o.n(v);const b=flarum.core.compat["common/components/Button"];var L=o.n(b);const x=flarum.core.compat["common/components/Modal"];var D=o.n(x);const _=flarum.core.compat["forum/components/DiscussionPage"];var w=o.n(_);const C=flarum.core.compat["common/Component"];var P=o.n(C),S=o(879),j=o.n(S);const O=flarum.core.compat["common/helpers/icon"];var B=o.n(O);const N=function(t){if(t){var e=t.emoji?t.emoji():t;return e?m("img",{alt:t.country&&t.country()||"",className:"emoji",draggable:"false",loading:"lazy",src:"//cdn.jsdelivr.net/gh/twitter/twemoji@13/assets/72x72/"+j()(e)+".png"}):B()("fas fa-globe")}};var k=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.languages=e().store.all("discussion-languages"),this.options=this.languages.reduce((function(t,e){return t[e.code()]=m("span",null,N(e)," ",e.name()),t}),this.attrs.extra||{})},n.view=function(){var t=this.attrs,e=t.language,o=t.uppercase,n=e.name()||"";return m("span",null,N(e),"Â ",o?n.toUpperCase():n)},o}(P()),M=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.languages=e().store.all("discussion-languages"),this.current=this.attrs.selected||this.attrs.discussion&&this.attrs.discussion.language(),this.selected=this.current},n.className=function(){return"FoFLanguageDiscussionModal"},n.title=function(){return this.attrs.discussion?e().translator.trans("fof-discussion-language.forum.change_language.edit_title",{title:m("em",null,this.attrs.discussion.title())}):e().translator.trans("fof-discussion-language.forum.change_language.title")},n.content=function(){var t=this;return[m("div",{className:"Modal-body"},m("div",{className:"Form-group"},this.languages.map((function(e){return m(L(),{onclick:t.select.bind(t,e),className:"Button Button--block "+(t.selected===e?"active":"")},m(k,{language:e,uppercase:!0}))}))),!this.attrs.hideSubmitButton&&m("div",{className:"App-primaryControl"},L().component({type:"submit",className:"Button Button--primary",disabled:!this.selected||this.selected===this.current,loading:this.loading,icon:"fas fa-check"},e().translator.trans("fof-discussion-language.forum.change_language.submit_button"))))]},n.select=function(t){if(this.selected=t,this.attrs.hideSubmitButton)return this.onsubmit();m.redraw()},n.onsubmit=function(t){var o=this;t&&t.preventDefault();var n=this.attrs,a=n.discussion,s=n.onsubmit;if(this.loading=!0,!a)return this.hide(),void(s&&s(this.selected));var r=this.selected;a.save({relationships:{language:r}}).then((function(){return e().current instanceof w()&&e().current.stream.update(),o.hide()})).catch(this.loaded.bind(this))},o}(D());const A=flarum.core.compat["forum/components/IndexPage"];var q=o.n(A);const F=flarum.core.compat["forum/components/DiscussionComposer"];var I=o.n(F),T=function(t,e){return t.code().toLowerCase()>e.code().toLowerCase()};const z=flarum.core.compat["forum/components/DiscussionHero"];var R=o.n(z);const U=flarum.core.compat["forum/states/DiscussionListState"];var E=o.n(U);const G=flarum.core.compat["forum/components/DiscussionListItem"];var H=o.n(G);const W=flarum.core.compat["forum/states/GlobalSearchState"];var $=o.n(W);const J=flarum.core.compat["common/utils/setRouteWithForcedRefresh"];var K=o.n(J);const Q=flarum.core.compat["common/components/SelectDropdown"];var V=o.n(Q),X=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.languages=e().store.all("discussion-languages"),this.options=this.languages.reduce((function(t,e){return t[e.code()]=m(k,{language:e}),t}),this.attrs.extra||{})},n.view=function(){var t=this,o=e().forum.attribute("fof-discussion-language.showAnyLangOpt")?"any":e().translator.formatter.locale;return m(V(),{buttonClassName:"Button"},Object.keys(this.options).map((function(e){var n,a=t.attrs.selected?e===t.attrs.selected:e===o;return m(L(),{active:a,icon:!a||"fas fa-check",onclick:null==(n=t.attrs.onclick)||null==n.bind?void 0:n.bind(t,e)},t.options[e])})))},o}(P()),Y=function(t){var e,o;if(null==(e=(o=this.attrs.discussion).isPrivateDiscussion)||!e.call(o)){var n=this.attrs.discussion.language();n&&t.add("discussion-language",m("span",null,N(n)||m("i",{className:"fas fa-globe"}),m("code",null,n.name())),5)}},Z={Language:k,LanguageDiscussionModal:M,LanguageDropdown:X},tt={flag:N},et={Language:p};e().initializers.add("fof/discussion-language",(function(){e().store.models["discussion-languages"]=p,"flarum-tags"in flarum.extensions&&(c().prototype.localisedLastDiscussion=s().attribute("localisedLastDiscussion")),i().prototype.discussionLanguages=s().hasMany("discussionLanguages"),g().prototype.language=s().hasOne("language"),g().prototype.canChangeLanguage=s().attribute("canChangeLanguage"),(0,h.extend)(y(),"moderationControls",(function(t,o){o.canChangeLanguage()&&t.add("language",L().component({icon:"fas fa-globe",onclick:function(){return e().modal.show(M,{discussion:o})}},e().translator.trans("fof-discussion-language.forum.discussion_controls.change_language_button")))})),(0,h.extend)(q().prototype,"newDiscussionAction",(function(t){var o=e().search.params().language;if(o)t.then((function(t){return t.fields.language=e().store.getBy("discussion-languages","code",o)}));else{var n=e().forum.attribute("fof-discussion-language.composerLocaleDefault");e().composer.fields.language=n?e().store.getBy("discussion-languages","code",e().translator.formatter.locale):""}})),I().prototype.chooseLanguage=function(t,o){var n=this;e().modal.show(M,{selected:this.composer.fields.language,hideSubmitButton:t,onsubmit:function(t){n.composer.fields.language=t,n.$("textarea").focus(),o&&o()}})},(0,h.extend)(I().prototype,"headerItems",(function(t){this._isByobuComposer||t.add("language",m("a",{className:"DiscussionComposer-changeTags",onclick:this.chooseLanguage.bind(this,!0,null)},m("span",{className:"LanguageLabel "+(this.composer.fields.language?"":"none")},this.composer.fields.language?k.component({language:this.composer.fields.language,uppercase:!0}):e().translator.trans("fof-discussion-language.forum.composer_discussion.choose_language_link"))),20)})),(0,h.override)(I().prototype,"onsubmit",(function(t){return this._isByobuComposer?t():this.composer.fields.language?void t():this.chooseLanguage(!0,t)})),(0,h.extend)(I().prototype,"data",(function(t){this._isByobuComposer||(t.relationships=t.relationships||{},t.relationships.language=this.composer.fields.language||e().store.all("discussion-languages").sort(T)[0])})),(0,h.extend)(H().prototype,"infoItems",Y),(0,h.extend)(R().prototype,"items",Y),(0,h.extend)(E().prototype,"requestParams",(function(t){var o,n=e().current.data.routeName;if("byobuPrivate"!==n&&"byobuUserPrivate"!==n&&(t.include.push("language"),"user.discussions"!==n)){"following"===n&&t.filter.q&&(t.filter.q+=" is:"+(t.filter.subscription||"following"),delete t.filter.subscription);var a=e().search.params().language,s=null!=(o=e().search.params().language)?o:e().translator.formatter.locale,r=e().forum.attribute("fof-discussion-language.showAnyLangOpt");t.filter.q?r?a&&(t.filter.q+=" language:"+a):t.filter.q+=" language:"+s:r&&!a||(t.filter.language=s)}})),(0,h.extend)($().prototype,"stickyParams",(function(t){return t.language=m.route.param("language")})),(0,h.extend)(q().prototype,"viewItems",(function(t){var o,n;"byobuPrivate"!==e().current.data.routeName&&(e().forum.attribute("fof-discussion-language.showAnyLangOpt")?(o={any:e().translator.trans("fof-discussion-language.forum.index_language.any")},n="any"):n=e().translator.formatter.locale,t.add("language",X.component({extra:o,default:n,onclick:function(t){var o=e().search.params();t===n?delete o.language:o.language=t,K()(e().route(e().current.get("routeName"),o))},selected:e().search.params().language})))})),"flarum-tags"in flarum.extensions&&(c().prototype.lastPostedDiscussion=function(){var t,o,n,a=s().hasOne("lastPostedDiscussion").bind(this);if(!e().forum.attribute("fof-discussion-language.useLocaleForTagsPageLastDiscussion"))return a();var r=this.localisedLastDiscussion(),i=(null==(t=e().session.user)||null==t.preferences||null==(o=t.preferences())?void 0:o.locale)||e().translator.formatter.locale||e().forum.discussionLanguages()[0].code(),u=null==(n=e().forum.discussionLanguages().find((function(t){return t.code()===i})))?void 0:n.id();if(!u)return a();var c=r[u];return c?new(g())({attributes:{title:c.title,slug:c.id,lastPostedAt:new Date(1e3*c.at).toISOString()}}):a()})}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map